(function(a){var b={width:0,height:0,palette:["#4572A7","#AA4643","#89A54E","#80699B"],title:{text:"Main Title",verticalAlign:"top",horizontalAlign:"center",x:0,y:0},subTitle:{text:"Sub Title",verticalAlign:"top",horizontalAlign:"center",x:0,y:0},legend:{layout:"vertical",verticalAlign:"top",horizontalAlign:"right",x:0,y:0},series:[{name:"Demo Series 1",dataUrl:null,collectionDataKey:"collectionDataKey1",xDataKey:"xDataKey1",yDataKey:"yDataKey1",data:null,color:null},{name:"Demo Series 2",dataUrl:null,collectionDataKey:"collectionDataKey2",xDataKey:"xDataKey2",yDataKey:"yDataKey2",data:null,color:null}],chart:{margin:{top:8,right:16,bottom:8,left:16},xAxis:{title:"X-Axis Title",interval:5,gridStartAt:null,min:null,max:null,unit:""},yAxis:{title:"Y-Axis Title",interval:5,gridStartAt:null,min:null,max:null,unit:""}}},c={container:null,svg:null,graph:null,title:null,subTitle:null,legend:null,seriesLegends:[],xAxis:null,yAxis:null,chart:null,xGrid:null,yGrid:null,dataLinesBorder:null,dataLines:[]},d={chart:{}},e={options:function(a,c){if(a){var d=a.split(".");var e=d.length-1;var f=b;for(var g=0;g<e&&f;g++)f=f[d[g]];if(f){if(c){f[d[e]]=c}return f[d[e]]}}return null},graph:function(a,d){if(a)b.width=a;if(d)b.height=d;if(!c.svg){c.svg=c.container.append("svg:svg").attr("class","chart")}if(!c.graph){c.graph=c.svg.append("svg:g")}c.svg.attr("width",b.width);c.svg.attr("height",b.height);c.graph.text(null);c.title=c.subTitle=c.legend=c.xAxis=c.yAxis=c.chart=null;e.title();e.chartArea();e.series();return c.graph},title:function(a,d,f,g,h){if(a)b.title.text=a;if(d)b.title.verticalAlign=d;if(f)b.title.horizontalAlign=f;if(typeof g==="number"&&g>=0)b.title.x=g;if(typeof h==="number"&&h>=0)b.title.y=h;if(!c.title){c.title=c.graph.append("svg:text").attr("class","chart-title")}c.title.text(b.title.text);var g=0,h=0,i=c.title[0][0].clientWidth,j=c.title[0][0].clientHeight,k="";switch(b.title.horizontalAlign){case"left":g=b.title.x;k="text-anchor: start";break;case"center":g=b.width/2;k="text-anchor: middle";break;case"right":g=b.width-b.title.x;k="text-anchor: end";break}switch(b.title.verticalAlign){case"top":h=b.title.y;break;case"middle":h=b.height/2;break;case"bottom":h=b.height-j-b.title.y;break}c.title.attr("x",g).attr("y",h).attr("style",k);e.subTitle();return c.title},subTitle:function(a,d,e,f,g){if(a)b.subTitle.text=a;if(d)b.subTitle.verticalAlign=d;if(e)b.subTitle.horizontalAlign=e;if(typeof f==="number"&&f>=0)b.subTitle.x=f;if(typeof g==="number"&&g>=0)b.subTitle.y=g;if(!c.subTitle){c.subTitle=c.graph.append("svg:text").attr("class","chart-subtitle")}c.subTitle.text(b.subTitle.text);var f=0,g=0,h=c.subTitle[0][0].clientWidth,i=c.subTitle[0][0].clientHeight,j=parseInt(c.title.attr("y")),k=c.title[0][0].clientHeight,l="";switch(b.subTitle.horizontalAlign){case"left":f=b.subTitle.x;l="text-anchor: start";break;case"center":f=b.width/2;l="text-anchor: middle";break;case"right":f=b.width-b.subTitle.x;l="text-anchor: end";break}switch(b.subTitle.verticalAlign){case"top":g=(b.title.verticalAlign==="top"?j+k:0)+b.subTitle.y;break;case"middle":g=b.height/2;break;case"bottom":g=b.height-(b.title.verticalAlign==="bottom"?k:0)-i-b.subTitle.y;break}c.subTitle.attr("x",f).attr("y",g).attr("style",l);return c.subTitle},legend:function(d,e,f,g,h){if(d&&(d==="vertical"||d==="horizontal"))b.legend.layout=d;if(e&&(e==="top"||e==="middle"||e==="bottom"))b.legend.verticalAlign=e;if(f&&(f==="left"||f==="center"||f==="right"))b.legend.horizontalAlign=f;if(typeof g==="number"&&g>=0)b.legend.x=g;if(typeof h==="number"&&h>=0)b.legend.y=h;if(!c.legend){c.legend=c.graph.append("svg:g").attr("class","chart-legend")}c.legend.text(null);var i=8,j=8,k=6,l=20;c.seriesLegends=[];for(var m=0;m<b.series.length;m++){if(!b.series[m].color)b.series[m].color=b.palette[m%b.palette.length];var n=c.seriesLegends[m]=c.legend.append("svg:text").attr("class","chart-legend-series").attr("x",i+l+2*k).attr("y",j).text(b.series[m].name);c.legend.append("svg:rect").attr("stroke-width",0).attr("fill",b.series[m].color).attr("x",i).attr("y",j+n[0][0].clientHeight/2-5).attr("width",l).attr("height",2);c.legend.append("svg:circle").attr("stroke",b.series[m].color).attr("stroke-width",2).attr("fill",b.series[m].color).attr("r",3).attr("cx",i+l/2).attr("cy",j+n[0][0].clientHeight/2-4);switch(b.legend.layout){case"vertical":j+=n[0][0].clientHeight;break;case"horizontal":i+=n[0][0].clientWidth+l+2*k;break}}var o=16,p=10;switch(b.legend.layout){case"vertical":o+=d3.max(a.map(c.seriesLegends,function(a){return a[0][0].clientWidth+l+2*k}));p+=d3.sum(a.map(c.seriesLegends,function(a){return a[0][0].clientHeight}));break;case"horizontal":o+=d3.sum(a.map(c.seriesLegends,function(a){return a[0][0].clientWidth+l+2*k}));p+=d3.max(a.map(c.seriesLegends,function(a){return a[0][0].clientHeight}));break}c.legend.insert("svg:rect","text").attr("x",0).attr("y",0).attr("width",o).attr("height",p).attr("rx",4).attr("ry",4).attr("class","chart-legend-border");var q=0;var r=0;switch(b.legend.horizontalAlign){case"left":q=b.legend.x;break;case"center":q=b.width/2-o/2;break;case"right":q=b.width-o-b.legend.x;break}switch(b.legend.verticalAlign){case"top":r=b.legend.y;break;case"middle":r=b.height/2-p/2;break;case"bottom":r=b.height-p-b.legend.y;break}c.legend.attr("transform","translate("+q+", "+r+")")},series:function(a){if(a&&a.length)b.series=a;e.legend();e.refresh();return b.series},chartArea:function(d,f,g){if(d)a.extend(true,b.chart.margin,d);if(f)a.extend(true,b.chart.xAxis,f);if(g)a.extend(true,b.chart.yAxis,g);if(!c.xAxis){c.xAxis=c.graph.append("svg:text").attr("class","chart-axis-title x")}c.xAxis.text(b.chart.xAxis.title).attr("x",b.chart.margin.left+(b.width-b.chart.margin.left-b.chart.margin.right)/2).attr("y",b.height-b.chart.margin.bottom+2*c.xAxis[0][0].clientHeight);if(!c.yAxis){c.yAxis=c.graph.append("svg:text").attr("class","chart-axis-title y")}c.yAxis.text(b.chart.yAxis.title).attr("x",b.chart.margin.left-2*c.xAxis[0][0].clientHeight).attr("y",b.chart.margin.top+(b.height-b.chart.margin.top-b.chart.margin.bottom)/2).attr("transform","rotate(270 "+c.yAxis.attr("x")+" "+c.yAxis.attr("y")+")");e.series();return{xAxis:c.xAxis,yAxis:c.yAxis}},refresh:function(){var c=0;a.each(b.series,function(d,e){if(e.data&&e.data.length||e.dataUrl){a.ajax({method:"GET",url:e.dataUrl,dataType:"json",success:function(a){e.data=a?e.collectionDataKey?a[e.collectionDataKey]:a:null},error:function(a){e.data=null},complete:function(){++c;if(c==b.series.length){f.plotChart()}}})}else{++c;if(c==b.series.length){f.plotChart()}}});return this}},f={init:function(c){a.extend(true,b,c);if(b.dataUrl){a.each(b.axis.y.series,function(a,c){c.dataUrl=b.dataUrl})}f.initSettings(a(this))},initSettings:function(a){a.html("");c.container=d3.select(a.selector);c.svg=c.graph=null;e.graph()},getChartDataLimits:function(){var c=[];var e=[];if(typeof b.chart.xAxis.gridStartAt==="number"&&!isNaN(b.chart.xAxis.gridStartAt)){c.push(b.chart.xAxis.gridStartAt)}if(typeof b.chart.xAxis.min==="number"&&!isNaN(b.chart.xAxis.min)){c.push(b.chart.xAxis.min)}if(typeof b.chart.xAxis.max==="number"&&!isNaN(b.chart.xAxis.max)){c.push(b.chart.xAxis.max)}if(typeof b.chart.yAxis.gridStartAt==="number"&&!isNaN(b.chart.yAxis.gridStartAt)){e.push(b.chart.yAxis.gridStartAt)}if(typeof b.chart.yAxis.min==="number"&&!isNaN(b.chart.yAxis.min)){e.push(b.chart.yAxis.min)}if(typeof b.chart.yAxis.max==="number"&&!isNaN(b.chart.yAxis.max)){e.push(b.chart.yAxis.max)}a.each(b.series,function(b,d){if(d.data){a.merge(c,a.map(d.data,function(a){return a[d.xDataKey]}));a.merge(e,a.map(d.data,function(a){return a[d.yDataKey]}))}});d.chart.x={min:d3.min(c),max:d3.max(c)};d.chart.x.gridStartAt=typeof b.chart.xAxis.gridStartAt==="number"&&!isNaN(b.chart.xAxis.gridStartAt)?b.chart.xAxis.gridStartAt:d.chart.x.min;d.chart.y={min:d3.min(e),max:d3.max(e)};d.chart.y.gridStartAt=typeof b.chart.yAxis.gridStartAt==="number"&&!isNaN(b.chart.yAxis.gridStartAt)?b.chart.yAxis.gridStartAt:d.chart.y.min},setChartProperties:function(){d.chart.width=b.width-b.chart.margin.left-b.chart.margin.right;d.chart.height=b.height-b.chart.margin.top-b.chart.margin.bottom;d.chart.x.step=Math.floor(d.chart.width/(d.chart.x.max-d.chart.x.min)*10)/10;d.chart.y.step=Math.floor(d.chart.height/(d.chart.y.max-d.chart.y.min)*10)/10},plotXGrid:function(){if(!c.xGrid){c.xGrid=c.chart.append("svg:g")}var a=d.chart.x.gridStartAt,e=b.chart.margin.left+(a-d.chart.x.min)*d.chart.x.step,f=b.chart.margin.top,g=e,h=f+d.chart.height+4,i=h+4;while(a<=d.chart.x.max){c.xGrid.append("svg:line").attr("class","chart-axis-grid x").attr("x1",e).attr("y1",f).attr("x2",g).attr("y2",h);c.xGrid.append("svg:text").attr("class","chart-axis-grid-text x").text(a).attr("x",e).attr("y",i);a+=b.chart.xAxis.interval;e=g+=b.chart.xAxis.interval*d.chart.x.step}},plotYGrid:function(){if(!c.yGrid){c.yGrid=c.chart.append("svg:g")}var a=d.chart.y.gridStartAt,e=b.chart.margin.left-4,f=b.chart.margin.top+d.chart.height-(a-d.chart.y.min)*d.chart.y.step,g=b.chart.margin.left+d.chart.width,h=f,i=e-4;while(a<=d.chart.y.max){c.yGrid.append("svg:line").attr("class","chart-axis-grid y").attr("x1",e).attr("y1",f).attr("x2",g).attr("y2",h);c.yGrid.append("svg:text").attr("class","chart-axis-grid-text y").text(a).attr("x",i).attr("y",f);a+=b.chart.yAxis.interval;f=h-=b.chart.yAxis.interval*d.chart.y.step}},plotDataLines:function(){if(!c.dataLinesBorder){c.dataLinesBorder=c.chart.append("svg:rect").attr("x",b.chart.margin.left).attr("y",b.chart.margin.top).attr("width",d.chart.width).attr("height",d.chart.height).attr("class","chart-data-border")}var e=c.chart.selectAll("path.line").data(b.series).enter().append("svg:g");a.each(b.series,function(a,c){var f=e.data(c.data).enter();f.append("svg:path").attr("stroke",c.color).attr("class","chart-data-line").attr("d",d3.svg.line().x(function(a){return b.chart.margin.left+(a[c.xDataKey]-d.chart.x.min)*d.chart.x.step}).y(function(a){return b.chart.margin.top+d.chart.height-(a[c.yDataKey]-d.chart.y.min)*d.chart.y.step}).interpolate("linear").tension(.6)(c.data));f.append("svg:circle").attr("stroke",c.color).attr("fill",c.color).attr("class","chart-data-point").on("mouseover",function(a,b){var c=d3.select(this);c.attr("fill","none").attr("class",c.attr("class")+" mouseover")}).on("mouseout",function(a,b){var c=d3.select(this);c.attr("fill",c.attr("stroke")).attr("class",c.attr("class").replace(" mouseover",""))}).attr("r",3).attr("cx",function(a){return b.chart.margin.left+(a[c.xDataKey]-d.chart.x.min)*d.chart.x.step}).attr("cy",function(a){return b.chart.margin.top+d.chart.height-(a[c.yDataKey]-d.chart.y.min)*d.chart.y.step}).append("title").text(function(a){return a[c.xDataKey]+b.chart.xAxis.unit+", "+a[c.yDataKey]+b.chart.yAxis.unit})})},plotChart:function(){if(!c.chart){c.chart=c.graph.append("svg:g")}c.chart.text(null);c.xGrid=c.yGrid=c.dataLinesBorder=null;f.getChartDataLimits();f.setChartProperties();f.plotXGrid();f.plotYGrid();f.plotDataLines()}};a.fn.linechart=function(b){if(e[b]){return e[b].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof b==="object"||!b){f.init.apply(this,arguments);return this}else{a.error("Invalid method"+b)}}})(jQuery)
